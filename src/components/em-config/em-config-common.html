<link rel="import" href="../em-abbreviation-preview/em-abbreviation-preview.html" />
<link rel="import" href="./em-config-key-value.html" />
<link rel="import" href="./em-config-options.html" />

<link rel="stylesheet" href="./em-config-common.scss" />
<script src="./em-config-common.ts"></script>
<template>
    <main>
        <em-config-options data={#options}
            form={#optionsForm}
            defaults={#optionsDefaults}
            on:update={onUpdateOptions} />

        <section class="variables">
            <h3>Variables</h3>
            <p class="comment">
                Variables can be used in abbreviations as reusable text values, which can be redefined without updating snippets.
                For example, you can create <code>lang</code> variable with <em>en_US</em> value and use it
                in abbreviations as <code>$&#123;lang}</code>.
                See “Snippets” section below for more examples.
            </p>

            <button on:click:prevent={onVariableAdd}>Add variable</button>
            <e:for-each select={#variables} key={@value.id}>
                <em-config-key-value
                    item={@value}
                    keyMode="text/plain"
                    valueMode="text/plain"
                    editField={!@value.key ? 'key' : null}
                    on:remove={onVariableRemove(@value.id)}
                    on:submit={onVariableSubmit} />
            </e:for-each>
        </section>

        <section class="snippets">
            <h2>Snippets</h2>
            <ul class="tabs">
                <e:for-each select={#snippetsSections} key={@value.id}>
                    <li class:selected={@value.selected} on:click={onSelectSnippetsSection(@value.id)}>{@value.label}</li>
                </e:for-each>
            </ul>
            <e:var section={#snippetsSections[section => section.selected]}/>

            <p class="comment" e:if={@section.comment}>{{@section.comment}}</p>
            <button on:click:prevent={onSnippetAdd}>Add snippet</button>

            <e:for-each select={#snippets[@section.id]} key={@value.id}>
                <em-config-key-value
                    item={@value}
                    keyMode="emmet-snippet"
                    valueMode={@section.id === 'markup' ? 'emmet-abbreviation' : 'text/plain'}
                    editField={!@value.key ? 'key' : null}
                    on:remove={onSnippetRemove(@value.id)}
                    on:submit={onSnippetSubmit} />
            </e:for-each>
        </section>
        <footer>
            <button type="submit" on:click:prevent={onSubmit}>Submit</button>
            <button type="reset" on:click:prevent={onReset}>Reset</button>
        </footer>
    </main>
    <aside>
        <h3>Interactive preview</h3>
        <em-abbreviation-preview
            abbr="main>.field+input[disabled]"
            mode="emmet-abbreviation"
            options={#editorConfig} />
    </aside>
</template>
